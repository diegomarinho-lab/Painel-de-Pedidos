<!DOCTYPE html>
<html lang="pt-br">
<head>
Â  <meta charset="utf-8" />
Â  <meta name="viewport" content="width=device-width, initial-scale=1" />
Â  <title>Painel de Pedidos - Doremus</title>
Â  <style>
Â  Â  /* VARS DO DASHBOARD */
Â  Â  :root {
Â  Â  Â  --bg: #ffffff;
Â  Â  Â  --text: #0b1f52;
Â  Â  Â  --muted: #4b5563;
Â  Â  Â  --accent: #c81e1e;
Â  Â  Â  --primary: #1e3a8a;
Â  Â  Â  --card: #f9fafb;
Â  Â  Â  --chip: #eef2ff;
Â  Â  Â  --border: #d1d5db;
Â  Â  Â  --stage1: #9ca3af;
Â  Â  Â  --stage2: #2563eb;
Â  Â  Â  --stage3: #16a34a;
Â  Â  Â  --danger-bg: #fee2e2; --danger-tx: #b91c1c;
Â  Â  Â  --warn-bg: #fef3c7;Â  Â --warn-tx: #b45309;
Â  Â  Â  --ok-bg: #dcfce7;Â  Â  Â --ok-tx: #166534;

Â  Â  Â  /* VARS DO RASTREADOR (Adaptadas) */
Â  Â  Â  --doremus-blue: var(--primary); /* Reutilizando a cor primÃ¡ria */
Â  Â  Â  --doremus-red: var(--accent); /* Reutilizando a cor de destaque */
Â  Â  Â  --doremus-blue-light: #0056CC;
Â  Â  }

Â  Â  html, body {
Â  Â  Â  margin: 0; padding: 0; background: var(--bg); color: var(--text);
Â  Â  Â  font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, "Helvetica Neue", Arial;
Â  Â  }

Â  Â  .layout {
Â  Â  Â  display: grid;
Â  Â  Â  grid-template-columns: 240px 1fr;
Â  Â  Â  min-height: 100vh;
Â  Â  }

Â  Â  /* Sidebar fixa */
Â  Â  .sidebar {
Â  Â  Â  position: sticky;
Â  Â  Â  top: 0;
Â  Â  Â  height: 100vh;
Â  Â  Â  overflow-y: auto;
Â  Â  Â  background: #f3f4f6;
Â  Â  Â  border-right: 1px solid var(--border);
Â  Â  Â  padding: 16px;
Â  Â  Â  /* Novo estilo para empurrar o rodapÃ© para baixo */
Â  Â  Â  display: flex;
Â  Â  Â  flex-direction: column;Â 
Â  Â  }
Â  Â  .sidebar .logo {
Â  Â  Â  display: flex; align-items: center; gap: 10px; margin-bottom: 12px;
Â  Â  }
Â  Â  .sidebar h3 { font-size: 14px; margin: 0 0 8px 0; color: var(--primary); }
Â  Â  .sidebar label {
Â  Â  Â  display: flex; align-items: center; gap: 8px;
Â  Â  Â  margin-bottom: 8px; font-size: 13px; color: var(--muted);
Â  Â  Â  cursor: pointer;
Â  Â  }
Â  Â  .sidebar input[type="checkbox"] { transform: scale(1.1); }
Â  Â Â 
Â  Â  /* Novo estilo para o rodapÃ© da sidebar */
Â  Â  .sidebar-footer {
Â  Â  Â  Â  margin-top: auto; /* Empurra para o final */
Â  Â  Â  Â  padding-top: 15px;
Â  Â  Â  Â  border-top: 1px solid var(--border);
Â  Â  Â  Â  font-size: 11px;
Â  Â  Â  Â  color: var(--muted);
Â  Â  Â  Â  text-align: center;
Â  Â  }

Â  Â  header {
Â  Â  Â  position: sticky; top: 0; z-index: 10;
Â  Â  Â  background: #ffffff; border-bottom: 1px solid var(--border);
Â  Â  }
Â  Â  .header-row {
Â  Â  Â  display: flex; align-items: center; justify-content: space-between;
Â  Â  Â  gap: 16px; flex-wrap: wrap; padding: 16px 20px;
Â  Â  }
Â  Â  .title { font-weight: 800; font-size: 18px; color: var(--primary); }
Â  Â  .meta { font-size: 12px; color: var(--muted); }
Â  Â  .btn {
Â  Â  Â  background: var(--accent); color: #fff; border: none;
Â  Â  Â  padding: 8px 12px; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 14px;
Â  Â  }

Â  Â  /* Barra de pesquisa (agora fixa no header) */
Â  Â  .search-bar {
Â  Â  Â  display: flex; justify-content: center; padding: 12px;
Â  Â  Â  background: #fafafa;
Â  Â  }
Â  Â  .search-bar input {
Â  Â  Â  width: 60%; max-width: 500px;
Â  Â  Â  padding: 8px 12px; border: 1px solid var(--border); border-radius: 8px; font-size: 14px;
Â  Â  }

Â  Â  .filters {
Â  Â  Â  display: flex; align-items: center; gap: 8px;
Â  Â  Â  padding: 10px 20px; border-bottom: 1px solid var(--border); background: #fafafa;
Â  Â  }
Â  Â  .filter-btn {
Â  Â  Â  border: 1px solid var(--border); background: var(--chip); color: var(--primary);
Â  Â  Â  padding: 6px 12px; border-radius: 999px; font-weight: 600; cursor: pointer; font-size: 13px;
Â  Â  }
Â  Â  .filter-btn.active { background: var(--primary); color: #fff; border-color: var(--primary); }

Â  Â  main { padding: 16px 20px; }

Â  Â  .grid {
Â  Â  Â  display: grid;
Â  Â  Â  grid-template-columns: repeat(4, minmax(240px, 1fr));
Â  Â  Â  gap: 12px;
Â  Â  }

Â  Â  .card {
Â  Â  Â  background: var(--card); border: 1px solid var(--border); border-radius: 12px;
Â  Â  Â  display: flex; flex-direction: column; height: 400px; overflow: hidden;
Â  Â  }
Â  Â  /* Fundo verde quando faturado */
Â  Â  .card.faturado {
Â  Â  Â  background: #ecfdf5;
Â  Â  Â  border-color: #a7f3d0;
Â  Â  }

Â  Â  .card-header {
Â  Â  Â  padding: 12px; border-bottom: 1px solid var(--border);
Â  Â  Â  display: grid; grid-template-columns: 1fr auto; gap: 10px;
Â  Â  }
Â  Â  .card-title { font-weight: 700; font-size: 14px; color: var(--primary); }
Â  Â  .card-sub { font-size: 12px; color: var(--muted); }
Â  Â  .badge { padding: 4px 8px; border-radius: 999px; font-size: 12px; font-weight: 700; }
Â  Â  .badge-danger { background: var(--danger-bg); color: var(--danger-tx); }
Â  Â  .badge-warnÂ  Â { background: var(--warn-bg);Â  Â color: var(--warn-tx); }
Â  Â  .badge-okÂ  Â  Â { background: var(--ok-bg);Â  Â  Â color: var(--ok-tx); }

Â  Â  .card-body {
Â  Â  Â  flex: 1; padding: 12px; display: flex; flex-direction: column; gap: 10px; overflow-y: auto;
Â  Â  }
Â  Â  .progress { display: grid; grid-template-columns: repeat(3, 1fr); gap: 6px; }
Â  Â  .stage { height: 8px; border-radius: 6px; background: #e5e7eb; }
Â  Â  .stage.active-1 { background: var(--stage1); }
Â  Â  .stage.active-2 { background: var(--stage2); }
Â  Â  .stage.active-3 { background: var(--stage3); }
Â  Â  .stage-labels { display: grid; grid-template-columns: repeat(3, 1fr); gap: 6px; font-size: 11px; color: var(--muted); }

Â  Â  .item { padding: 10px; border: 1px solid var(--border); border-radius: 10px; background: #fff; }
Â  Â  .item-top { display: flex; justify-content: space-between; gap: 8px; flex-wrap: wrap; }
Â  Â  .item-name { font-weight: 600; font-size: 13px; color: var(--primary); }
Â  Â  .item-code { font-size: 12px; color: var(--muted); }
Â  Â  .status-row { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-top: 6px; }
Â  Â  .status-col { font-size: 12px; color: var(--muted); }
Â  Â  .status-col b { color: var(--text); font-weight: 700; }

Â  Â  .footer {
Â  Â  Â  padding: 12px 20px; text-align: center; color: var(--muted); font-size: 12px; border-top: 1px solid var(--border);
Â  Â  }

Â  Â  /* ESTILOS DO RASTREADOR DE PEDIDOS (INSERIDOS) */
Â  Â  .tracker-wrapper {
Â  Â  Â  Â  padding: 16px 20px;
Â  Â  }
Â  Â  .tracker-container {
Â  Â  Â  background: white;
Â  Â  Â  border-radius: 12px;
Â  Â  Â  box-shadow: 0 0 20px rgba(0,0,0,0.1);
Â  Â  Â  overflow: hidden;
Â  Â  Â  max-width: 700px;
Â  Â  Â  margin: 0 auto;
Â  Â  Â  min-height: calc(100vh - 40px);
Â  Â  }
Â  Â Â 
Â  Â  .tracker-header {
Â  Â  Â  background: linear-gradient(135deg, var(--doremus-blue-light) 0%, var(--doremus-blue) 100%);
Â  Â  Â  color: white;
Â  Â  Â  padding: 30px;
Â  Â  Â  text-align: center;
Â  Â  }
Â  Â Â 
Â  Â  .tracker-header h1 {
Â  Â  Â  font-size: 28px;
Â  Â  Â  margin-bottom: 8px;
Â  Â  Â  font-weight: 600;
Â  Â  Â  display: flex;
Â  Â  Â  align-items: center;
Â  Â  Â  justify-content: center;
Â  Â  }
Â  Â Â 
Â  Â  .tracker-header p {
Â  Â  Â  font-size: 14px;
Â  Â  Â  opacity: 0.9;
Â  Â  }
Â  Â Â 
Â  Â  .tracker-content {
Â  Â  Â  padding: 30px;
Â  Â  }
Â  Â Â 
Â  Â  .tracker-form-group {
Â  Â  Â  margin-bottom: 20px;
Â  Â  }
Â  Â Â 
Â  Â  .tracker-content label {
Â  Â  Â  display: block;
Â  Â  Â  font-weight: 600;
Â  Â  Â  color: #333;
Â  Â  Â  margin-bottom: 8px;
Â  Â  Â  font-size: 14px;
Â  Â  }
Â  Â Â 
Â  Â  .tracker-content input[type="text"] {
Â  Â  Â  width: 100%;
Â  Â  Â  padding: 12px 15px;
Â  Â  Â  border: 2px solid #e0e0e0;
Â  Â  Â  border-radius: 6px;
Â  Â  Â  font-size: 16px;
Â  Â  Â  transition: all 0.3s ease;
Â  Â  }
Â  Â Â 
Â  Â  .tracker-content input[type="text"]:focus {
Â  Â  Â  outline: none;
Â  Â  Â  border-color: var(--doremus-blue);
Â  Â  Â  box-shadow: 0 0 0 3px rgba(0, 71, 171, 0.1);
Â  Â  }
Â  Â Â 
Â  Â  .tracker-button-group {
Â  Â  Â  display: flex;
Â  Â  Â  gap: 10px;
Â  Â  Â  margin-top: 25px;
Â  Â  }
Â  Â Â 
Â  Â  .tracker-content button {
Â  Â  Â  flex: 1;
Â  Â  Â  padding: 12px 20px;
Â  Â  Â  border: none;
Â  Â  Â  border-radius: 6px;
Â  Â  Â  font-size: 16px;
Â  Â  Â  font-weight: 600;
Â  Â  Â  cursor: pointer;
Â  Â  Â  transition: all 0.3s ease;
Â  Â  }
Â  Â Â 
Â  Â  .btn-search {
Â  Â  Â  background: linear-gradient(135deg, var(--doremus-blue-light) 0%, var(--doremus-blue) 100%);
Â  Â  Â  color: white;
Â  Â  }
Â  Â Â 
Â  Â  .btn-search:hover {
Â  Â  Â  transform: translateY(-2px);
Â  Â  Â  box-shadow: 0 10px 20px rgba(0, 71, 171, 0.3);
Â  Â  }
Â  Â Â 
Â  Â  .btn-search:disabled {
Â  Â  Â  opacity: 0.6;
Â  Â  Â  cursor: not-allowed;
Â  Â  Â  transform: none;
Â  Â  }
Â  Â Â 
Â  Â  .btn-clear {
Â  Â  Â  background: #f0f0f0;
Â  Â  Â  color: #333;
Â  Â  }
Â  Â Â 
Â  Â  .btn-clear:hover {
Â  Â  Â  background: #e0e0e0;
Â  Â  }
Â  Â Â 
Â  Â  .btn-download {
Â  Â  Â  background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
Â  Â  Â  color: white;
Â  Â  }
Â  Â Â 
Â  Â  .btn-download:hover {
Â  Â  Â  transform: translateY(-2px);
Â  Â  Â  box-shadow: 0 10px 20px rgba(76, 175, 80, 0.3);
Â  Â  }
Â  Â Â 
Â  Â  .tracker-results {
Â  Â  Â  margin-top: 30px;
Â  Â  Â  display: none;
Â  Â  }
Â  Â Â 
Â  Â  .tracker-results.show {
Â  Â  Â  display: block;
Â  Â  }
Â  Â Â 
Â  Â  .error {
Â  Â  Â  background: #fee;
Â  Â  Â  border-left: 4px solid var(--doremus-red);
Â  Â  Â  padding: 15px;
Â  Â  Â  border-radius: 4px;
Â  Â  Â  color: var(--doremus-red);
Â  Â  Â  margin-bottom: 20px;
Â  Â  }
Â  Â Â 
Â  Â  .success {
Â  Â  Â  background: #efe;
Â  Â  Â  border-left: 4px solid #4f4;
Â  Â  Â  padding: 15px;
Â  Â  Â  border-radius: 4px;
Â  Â  Â  color: #3a3;
Â  Â  Â  margin-bottom: 20px;
Â  Â  }
Â  Â Â 
Â  Â  .order-info {
Â  Â  Â  background: #f9f9f9;
Â  Â  Â  padding: 20px;
Â  Â  Â  border-radius: 8px;
Â  Â  Â  margin-bottom: 20px;
Â  Â  Â  border: 1px solid #e0e0e0;
Â  Â  }
Â  Â Â 
Â  Â  .info-row {
Â  Â  Â  display: grid;
Â  Â  Â  grid-template-columns: 1fr 1fr;
Â  Â  Â  gap: 20px;
Â  Â  Â  margin-bottom: 15px;
Â  Â  }
Â  Â Â 
Â  Â  .info-row:last-child {
Â  Â  Â  margin-bottom: 0;
Â  Â  }
Â  Â Â 
Â  Â  .info-item {
Â  Â  Â  padding: 10px 0;
Â  Â  }
Â  Â Â 
Â  Â  .info-label {
Â  Â  Â  font-size: 12px;
Â  Â  Â  font-weight: 600;
Â  Â  Â  color: #999;
Â  Â  Â  text-transform: uppercase;
Â  Â  Â  letter-spacing: 0.5px;
Â  Â  Â  margin-bottom: 5px;
Â  Â  }
Â  Â Â 
Â  Â  .info-value {
Â  Â  Â  font-size: 16px;
Â  Â  Â  font-weight: 600;
Â  Â  Â  color: #333;
Â  Â  Â  word-break: break-word;
Â  Â  }
Â  Â Â 
Â  Â  .timeline {
Â  Â  Â  margin-top: 20px;
Â  Â  }
Â  Â Â 
Â  Â  .timeline-title {
Â  Â  Â  font-size: 16px;
Â  Â  Â  font-weight: 600;
Â  Â  Â  color: var(--doremus-blue);
Â  Â  Â  margin-bottom: 15px;
Â  Â  }

Â  Â  .item-timeline-title {
Â  Â  Â  Â  font-size: 14px;
Â  Â  Â  Â  font-weight: 700;
Â  Â  Â  Â  color: #333;
Â  Â  Â  Â  margin-top: 20px;
Â  Â  Â  Â  margin-bottom: 10px;
Â  Â  Â  Â  padding-left: 10px;
Â  Â  Â  Â  border-left: 3px solid var(--doremus-blue);
Â  Â  }
Â  Â Â 
Â  Â  .timeline-item {
Â  Â  Â  position: relative;
Â  Â  Â  padding-left: 30px;
Â  Â  Â  margin-bottom: 20px;
Â  Â  Â  padding-bottom: 20px;
Â  Â  Â  border-left: 2px solid #e0e0e0;
Â  Â  }
Â  Â Â 
Â  Â  .timeline-item:last-child {
Â  Â  Â  border-left: none;
Â  Â  }
Â  Â Â 
Â  Â  .timeline-dot {
Â  Â  Â  position: absolute;
Â  Â  Â  left: -8px;
Â  Â  Â  top: 0;
Â  Â  Â  width: 14px;
Â  Â  Â  height: 14px;
Â  Â  Â  border-radius: 50%;
Â  Â  Â  background: var(--doremus-blue);
Â  Â  Â  border: 2px solid white;
Â  Â  Â  box-shadow: 0 0 0 2px var(--doremus-blue);
Â  Â  }
Â  Â Â 
Â  Â  .timeline-item.atrasado .timeline-dot {
Â  Â  Â  background: var(--doremus-red);
Â  Â  Â  box-shadow: 0 0 0 2px var(--doremus-red);
Â  Â  }
Â  Â Â 
Â  Â  .timeline-item.entregue .timeline-dot {
Â  Â  Â  background: #4f4;
Â  Â  Â  box-shadow: 0 0 0 2px #4f4;
Â  Â  }
Â  Â Â 
Â  Â  .timeline-status {
Â  Â  Â  font-weight: 600;
Â  Â  Â  color: #333;
Â  Â  Â  margin-bottom: 4px;
Â  Â  Â  font-size: 14px;
Â  Â  }
Â  Â Â 
Â  Â  .timeline-item.atrasado .timeline-status {
Â  Â  Â  color: var(--doremus-red);
Â  Â  }
Â  Â Â 
Â  Â  .timeline-item.entregue .timeline-status {
Â  Â  Â  color: #4f4;
Â  Â  }
Â  Â Â 
Â  Â  .timeline-previsao {
Â  Â  Â  font-size: 13px;
Â  Â  Â  color: #666;
Â  Â  Â  margin-bottom: 4px;
Â  Â  }
Â  Â Â 
Â  Â  .timeline-motivo {
Â  Â  Â  font-size: 13px;
Â  Â  Â  color: #999;
Â  Â  Â  font-style: italic;
Â  Â  }
Â  Â Â 
Â  Â  .timeline-data {
Â  Â  Â  font-size: 12px;
Â  Â  Â  color: #999;
Â  Â  Â  margin-top: 8px;
Â  Â  }
Â  Â Â 
Â  Â  .tracker-badge { /* Renomeado de .badge para evitar conflito */
Â  Â  Â  display: inline-block;
Â  Â  Â  padding: 4px 10px;
Â  Â  Â  border-radius: 4px;
Â  Â  Â  font-size: 11px;
Â  Â  Â  font-weight: 600;
Â  Â  Â  margin-left: 8px;
Â  Â  Â  text-transform: uppercase;
Â  Â  }
Â  Â Â 
Â  Â  .badge-atrasado {
Â  Â  Â  background: #fee;
Â  Â  Â  color: var(--doremus-red);
Â  Â  }
Â  Â Â 
Â  Â  .badge-entregue {
Â  Â  Â  background: #efe;
Â  Â  Â  color: #4f4;
Â  Â  }
Â  Â Â 
Â  Â  .loading {
Â  Â  Â  text-align: center;
Â  Â  Â  padding: 20px;
Â  Â  Â  color: var(--doremus-blue);
Â  Â  }
Â  Â Â 
Â  Â  .spinner {
Â  Â  Â  border: 3px solid #f0f0f0;
Â  Â  Â  border-top: 3px solid var(--doremus-blue);
Â  Â  Â  border-radius: 50%;
Â  Â  Â  width: 30px;
Â  Â  Â  height: 30px;
Â  Â  Â  animation: spin 1s linear infinite;
Â  Â  Â  margin: 0 auto 10px;
Â  Â  }
Â  Â Â 
Â  Â  @keyframes spin {
Â  Â  Â  0% { transform: rotate(0deg); }
Â  Â  Â  100% { transform: rotate(360deg); }
Â  Â  }

Â  Â  .item-selection {
Â  Â  Â  Â  margin-top: 20px;
Â  Â  Â  Â  padding: 15px;
Â  Â  Â  Â  border: 1px solid #e0e0e0;
Â  Â  Â  Â  border-radius: 8px;
Â  Â  Â  Â  background: #f5f5f5;
Â  Â  }

Â  Â  .item-selection label {
Â  Â  Â  Â  font-weight: 700;
Â  Â  Â  Â  color: #333;
Â  Â  Â  Â  margin-bottom: 10px;
Â  Â  }

Â  Â  .item-list {
Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  flex-direction: column;
Â  Â  Â  Â  gap: 8px;
Â  Â  Â  Â  margin-top: 10px;
Â  Â  }

Â  Â  .item-list input[type="checkbox"] {
Â  Â  Â  Â  margin-right: 10px;
Â  Â  }

Â  Â  .item-list label {
Â  Â  Â  Â  font-weight: 400;
Â  Â  Â  Â  color: #555;
Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  align-items: center;
Â  Â  }
Â  </style>
</head>
<body>
Â  <div class="layout">
Â  Â  <aside class="sidebar">
Â  Â  Â  <div class="logo">
Â  Â  Â  Â  <img id="logoImg" src="" alt="Logo Doremus" height="40">
Â  Â  Â  Â  <span style="font-weight:800; color: var(--primary);">Doremus Alimentos</span>
Â  Â  Â  </div>
Â  Â  Â Â 
Â  Â  Â  <p style="margin: 16px 0 8px 0;">
Â  Â  Â  Â  <a href="https://www.appsheet.com/start/c98df043-946e-4d35-a171-89bc9cf3d2e4" target="_blank" style="
Â  Â  Â  Â  Â  display: block;Â 
Â  Â  Â  Â  Â  padding: 8px 12px;Â 
Â  Â  Â  Â  Â  background: var(--accent);Â 
Â  Â  Â  Â  Â  color: #fff;Â 
Â  Â  Â  Â  Â  text-decoration: none;Â 
Â  Â  Â  Â  Â  border-radius: 8px;Â 
Â  Â  Â  Â  Â  font-weight: 600;Â 
Â  Â  Â  Â  Â  font-size: 14px;
Â  Â  Â  Â  Â  text-align: center;
Â  Â  Â  Â  ">
Â  Â  Â  Â  Â  Carteira de Pedidos
Â  Â  Â  Â  </a>
Â  Â  Â  </p>
Â  Â  Â Â 
Â  Â  Â  <p style="margin: 8px 0 16px 0;">
Â  Â  Â  Â  <a href="#" id="trackerLink" onclick="toggleView('tracker')" style="
Â  Â  Â  Â  Â  display: block;Â 
Â  Â  Â  Â  Â  padding: 8px 12px;Â 
Â  Â  Â  Â  Â  background: var(--primary); /* Inativo por padrÃ£o */
Â  Â  Â  Â  Â  color: #fff;Â 
Â  Â  Â  Â  Â  text-decoration: none;Â 
Â  Â  Â  Â  Â  border-radius: 8px;Â 
Â  Â  Â  Â  Â  font-weight: 600;Â 
Â  Â  Â  Â  Â  font-size: 14px;
Â  Â  Â  Â  Â  text-align: center;
Â  Â  Â  Â  ">
Â  Â  Â  Â  Â  Rastreador de Pedidos
Â  Â  Â  Â  </a>
Â  Â  Â  </p>

Â  Â  Â  <h3>Filtrar divisÃ£o</h3>
Â  Â  Â  <div id="divisionFilters"></div>
Â  Â  Â Â 
Â  Â  Â  <div class="sidebar-footer">
Â  Â  Â  Â  Desenvolvido por Diego Marinho<br>
Â  Â  Â  Â  Controladoria de Vendas
Â  Â  Â  </div>
Â  Â  </aside>

Â  Â  <div id="contentWrapper" style="display:flex; flex-direction:column; width: 100%;">
Â  Â  Â Â 
Â  Â  Â  <div id="dashboardContent" style="width: 100%;">
Â  Â  Â  Â  <header>
Â  Â  Â  Â  Â  <div class="header-row">
Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  <div class="title">Painel de Pedidos Pendentes</div>
Â  Â  Â  Â  Â  Â  Â  <div id="meta" class="meta">Carregando...</div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <button id="refreshBtn" class="btn">Atualizar</button>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  <div class="search-bar">
Â  Â  Â  Â  Â  Â  <input type="text" id="searchInput" placeholder="Buscar pedido, cliente, item ou divisÃ£o..." />
Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  <div class="filters">
Â  Â  Â  Â  Â  Â  <button class="filter-btn active" data-cat="Atrasados">Atrasados</button>
Â  Â  Â  Â  Â  Â  <button class="filter-btn" data-cat="Para Hoje">Para Hoje</button>
Â  Â  Â  Â  Â  Â  <button class="filter-btn" data-cat="Futuros">Futuros</button>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </header>

Â  Â  Â  Â  <main>
Â  Â  Â  Â  Â  <div id="sections"></div>
Â  Â  Â  Â  Â  <div class="footer">
Â  Â  Â  Â  Â  Â  <span id="footerMeta">AtualizaÃ§Ãµes automÃ¡ticas a cada 10 minutos.</span>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </main>
Â  Â  Â  </div>

Â  Â  Â  <div id="trackerContent" class="tracker-wrapper" style="display:none;">
Â  Â  Â  Â  <div style="margin-bottom: 20px;">
Â  Â  Â  Â  Â  <a href="#" onclick="toggleView('dashboard')" style="font-weight: 600; color: var(--primary); text-decoration: none; display: inline-flex; align-items: center; gap: 5px;">
Â  Â  Â  Â  Â  Â  &#x2190; Voltar para o Painel de Pedidos
Â  Â  Â  Â  Â  </a>
Â  Â  Â  Â  </div>
Â  Â  Â  Â Â 
Â  Â  Â  Â  <div class="tracker-container">
Â  Â  Â  Â  Â  <div class="tracker-header">
Â  Â  Â  Â  Â  Â  <h1>
Â  Â  Â  Â  Â  Â  Â  <img src="https://www.appsheet.com/fsimage.png?appid=e6dbb840-9231-483a-9c9c-f878f9afa058&datasource=google&filename=DocId%3D1xWPFjq8YL808Dv40uzwimCN0j8-UwwoD&signature=f8b5fd7133e3ad2b0f5f8f16ede0593312d97ed3f9f333f2b8957f84f58c29c4&tableprovider=google&userid=104514639"Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  alt="Logo Doremus"Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  style="height: 30px; margin-right: 10px; vertical-align: middle;">Â 
Â  Â  Â  Â  Â  Â  Â  Rastreador de Pedidos
Â  Â  Â  Â  Â  Â  </h1>
Â  Â  Â  Â  Â  Â  <p>Consulte o histÃ³rico completo de acompanhamento do seu pedido</p>
Â  Â  Â  Â  Â  Â  <p style="font-size: 10px;">Desenvolvido por Diego Marinho - Supervisor de Controladoria de Vendas - 2025</p>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  <div class="tracker-content">
Â  Â  Â  Â  Â  Â  <div class="tracker-form-group">
Â  Â  Â  Â  Â  Â  Â  <label for="orderNumber">NÃºmero do Pedido</label>
Â  Â  Â  Â  Â  Â  Â  <inputÂ 
Â  Â  Â  Â  Â  Â  Â  Â  type="text"Â 
Â  Â  Â  Â  Â  Â  Â  Â  id="orderNumber"Â 
Â  Â  Â  Â  Â  Â  Â  Â  placeholder="Digite o nÃºmero do pedido (ex: 473457)"
Â  Â  Â  Â  Â  Â  Â  Â  onkeypress="if(event.key==='Enter') rastreadorBuscarPedido()"
Â  Â  Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  <div class="tracker-button-group">
Â  Â  Â  Â  Â  Â  Â  <button class="btn-search" onclick="rastreadorBuscarPedido()">ğŸ” Pesquisar</button>
Â  Â  Â  Â  Â  Â  Â  <button class="btn-clear" onclick="rastreadorLimpar()">Limpar</button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  <div id="itemSelectionContainer" class="item-selection" style="display: none;">
Â  Â  Â  Â  Â  Â  Â  <label>Selecione os Itens para Rastrear:</label>
Â  Â  Â  Â  Â  Â  Â  <div id="itemList" class="item-list">
Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  <div class="tracker-button-group" style="margin-top: 15px;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn-search" onclick="rastreadorRastrearItens()">Rastrear Itens Selecionados</button>
Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div class="tracker-button-group" id="downloadGroup" style="display: none; margin-top: 15px;">
Â  Â  Â  Â  Â  Â  Â  <button class="btn-download" onclick="rastreadorBaixarPDF()">ğŸ“¥ Baixar PDF</button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  <div class="tracker-results" id="trackerResults"></div>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>
Â  Â  </div>
Â  </div>

Â  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
Â  <script>
Â  Â  // --- LÃ“GICA DO DASHBOARD DE PEDIDOS PENDENTES ---
Â  Â  const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbyvSqRwhuFoHeFPKpsIY3oCoH0b84_uIkDntZhuAtLsV3XvWlgSKcvfNMyx_KDb5ro/exec';
Â  Â  const AUTO_REFRESH_MS = 600000; // 10 min
Â  Â  const LOGO_URL = 'https://www.appsheet.com/fsimage.png?appid=e6dbb840-9231-483a-9c9c-f878f9afa058&datasource=google&filename=DocId%3D1xWPFjq8YL808Dv40uzwimCN0j8-UwwoD&signature=f8b5fd7133e3ad2b0f5f8f16ede0593312d97ed3f9f333f2b8957f84f58c29c4&tableprovider=google&userid=104514639';
Â  Â  document.getElementById('logoImg').src = LOGO_URL;

Â  Â  let allPedidos = [];
Â  Â  let activeCategory = 'Atrasados';
Â  Â  let activeDivisions = new Set();

    // VERSÃƒO ANTERIOR: Sem Vendedora/Tipo Entrega/ObservaÃ§Ãµes
Â  Â  function formatDateIsoToBr(iso) {
Â  Â  Â  if (!iso) return '-';
Â  Â  Â  const [y, m, d] = iso.split('-');
Â  Â  Â  return `${d}/${m}/${y}`;
Â  Â  }
Â  Â  function stageClass(stage, index) {
Â  Â  Â  if (stage >= 3 && index === 3) return 'active-3';
Â  Â  Â  if (stage >= 2 && index === 2) return 'active-2';
Â  Â  Â  if (stage >= 1 && index === 1) return 'active-1';
Â  Â  Â  return '';
Â  Â  }
Â  Â  function badge(cat) {
Â  Â  Â  if (cat === 'Atrasados') return '<span class="badge badge-danger">Atrasados</span>';
Â  Â  Â  if (cat === 'Para Hoje') return '<span class="badge badge-warn">Para Hoje</span>';
Â  Â  Â  return '<span class="badge badge-ok">Futuros</span>';
Â  Â  }

Â  Â  async function fetchData() {
Â  Â  Â  const res = await fetch(WEB_APP_URL, { cache: 'no-store' });
Â  Â  Â  if (!res.ok) throw new Error(`Erro ao buscar dados: ${res.status} ${res.statusText}`);
Â  Â  Â  const data = await res.json();
Â  Â  Â  if (data?.error) throw new Error(data.message || 'Erro no backend');
Â  Â  Â  return data;
Â  Â  }

Â  Â  function renderCard(p) {
Â  Â  Â  const card = document.createElement('div');
Â  Â  Â  card.className = 'card';
Â  Â  Â  if (p.faturadoNumero) card.classList.add('faturado');

Â  Â  Â  const header = document.createElement('div');
Â  Â  Â  header.className = 'card-header';
      // MANTIDO: estrutura anterior que funcionava (mas sem os novos campos)
Â  Â  Â  header.innerHTML = `
Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  <div class="card-title">Pedido #${p.pedido}</div>
Â  Â  Â  Â  Â  <div class="card-sub">Cliente: ${p.cliente || '-'}</div>
Â  Â  Â  Â  Â  <div class="card-sub">DivisÃ£o: ${p.divisao || '-'}</div>
Â  Â  Â  Â  Â  <div class="card-sub">Entrega: ${formatDateIsoToBr(p.entregaDate) || '-'}</div>
Â  Â  Â  Â  Â  ${p.faturadoNumero ? `<div class="card-sub" style="color:var(--accent);font-weight:700">Faturado: ${String(p.faturadoNumero).padStart(9, '0')}</div>` : ''}
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div>${badge(p.categoria)}</div>
Â  Â  Â  `;

Â  Â  Â  const body = document.createElement('div');
Â  Â  Â  body.className = 'card-body';
Â  Â  Â  body.innerHTML = `
Â  Â  Â  Â  <div class="progress">
Â  Â  Â  Â  Â  <div class="stage ${stageClass(p.stage, 1)}"></div>
Â  Â  Â  Â  Â  <div class="stage ${stageClass(p.stage, 2)}"></div>
Â  Â  Â  Â  Â  <div class="stage ${stageClass(p.stage, 3)}"></div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="stage-labels">
Â  Â  Â  Â  Â  <div>A Liberar</div><div>Liberado</div><div>Faturado</div>
Â  Â  Â  Â  </div>
Â  Â  Â  `;

Â  Â  Â  (p.items || []).forEach(it => {
Â  Â  Â  Â  const itemDiv = document.createElement('div');
Â  Â  Â  Â  itemDiv.className = 'item';

Â  Â  Â  Â  const top = document.createElement('div');
Â  Â  Â  Â  top.className = 'item-top';
Â  Â  Â  Â  top.innerHTML = `
Â  Â  Â  Â  Â  <div class="item-name">${it?.itemDesc || '(Sem descriÃ§Ã£o)'}</div>
Â  Â  Â  Â  Â  <div class="item-code">CÃ³digo: ${it?.itemCode || '-'}</div>
Â  Â  Â  Â  `;

Â  Â  Â  Â  const statuses = document.createElement('div');
Â  Â  Â  Â  statuses.className = 'status-row';
Â  Â  Â  Â  statuses.innerHTML = `
Â  Â  Â  Â  Â  <div class="status-col"><b>HOJE:</b> ${it?.statusHoje || '-'}</div>
Â  Â  Â  Â  Â  <div class="status-col"><b>ONTEM:</b> ${it?.statusOntem || '-'}</div>
Â  Â  Â  Â  Â  <div class="status-col"><b>ANTEONTEM:</b> ${it?.statusAnteontem || '-'}</div>
Â  Â  Â  Â  Â  <div class="status-col"><b>FALTA DE MP:</b> ${it?.statusFaltaMp || '-'}</div>
Â  Â  Â  Â  `;

Â  Â  Â  Â  itemDiv.appendChild(top);
Â  Â  Â  Â  itemDiv.appendChild(statuses);
Â  Â  Â  Â  body.appendChild(itemDiv);
Â  Â  Â  });

Â  Â  Â  card.appendChild(header);
Â  Â  Â  card.appendChild(body);
Â  Â  Â  return card;
Â  Â  }

Â  Â  function render(searchTerm = '') {
Â  Â  Â  // CondiÃ§Ã£o de saÃ­da ajustada: se o dashboard estÃ¡ explÃ­citamente escondido, nÃ£o renderiza.
Â  Â  Â  if (document.getElementById('dashboardContent').style.display === 'none') return;Â 
Â  Â  Â Â 
Â  Â  Â  const meta = document.getElementById('meta');
Â  Â  Â  const sections = document.getElementById('sections');
Â  Â  Â  sections.innerHTML = '';

Â  Â  Â  let filtered = allPedidos.filter(p => p.categoria === activeCategory);

Â  Â  Â  if (activeDivisions.size > 0) {
Â  Â  Â  Â  filtered = filtered.filter(p => p.divisao && activeDivisions.has(String(p.divisao).trim()));
Â  Â  Â  }

// Busca por Pedido, Cliente, DivisÃ£o ou Item
Â  Â  Â  if (searchTerm) {
Â  Â  Â  Â  const t = searchTerm.toLowerCase();
Â  Â  Â  Â  filtered = filtered.filter(p => {
Â  Â  Â  Â  Â  // 1. Busca nos campos principais (Pedido, Cliente, DivisÃ£o)
Â  Â  Â  Â  Â  if (
Â  Â  Â  Â  Â  Â  String(p.pedido).toLowerCase().includes(t) ||
Â  Â  Â  Â  Â  Â  (p.cliente || '').toLowerCase().includes(t) ||
Â  Â  Â  Â  Â  Â  (p.divisao || '').toLowerCase().includes(t)
Â  Â  Â  Â  Â  ) {
Â  Â  Â  Â  Â  Â  return true;
Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  // 2. Busca nos itens do pedido
Â  Â  Â  Â  Â  if (p.items && p.items.length > 0) {
Â  Â  Â  Â  Â  Â  return p.items.some(item =>Â 
Â  Â  Â  Â  Â  Â  Â  (item.itemDesc || '').toLowerCase().includes(t) ||
Â  Â  Â  Â  Â  Â  Â  (item.itemCode || '').toLowerCase().includes(t)
Â  Â  Â  Â  Â  Â  );
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  return false;
Â  Â  Â  Â  });
Â  Â  Â  }

Â  Â  Â  const grid = document.createElement('div');
Â  Â  Â  grid.className = 'grid';
Â  Â  Â  filtered.forEach(p => grid.appendChild(renderCard(p)));
Â  Â  Â  sections.appendChild(grid);

Â  Â  Â  meta.textContent = `Atualizado: ${new Date().toLocaleString()} â€¢ Categoria: ${activeCategory} â€¢ Exibindo: ${filtered.length}`;
Â  Â  }

    // FUNÃ‡ÃƒO DE CONTAGEM (VersÃ£o anterior sem contagem dinÃ¢mica nos botÃµes)
    /* A versÃ£o original que funcionava nÃ£o incluÃ­a a funÃ§Ã£o de contagem dinÃ¢mica nos botÃµes */

Â  Â  async function loadAndRender() {
Â  Â  Â  const meta = document.getElementById('meta');
Â  Â  Â  meta.textContent = 'Carregando...';
Â  Â  Â  try {
Â  Â  Â  Â  const data = await fetchData();
Â  Â  Â  Â  allPedidos = data?.pedidos || [];

Â  Â  Â  Â  const divs = Array.from(new Set(allPedidos.map(p => (p.divisao || '').trim()).filter(Boolean))).sort();
Â  Â  Â  Â  const filtersEl = document.getElementById('divisionFilters');
Â  Â  Â  Â  filtersEl.innerHTML = '';
Â  Â  Â  Â  activeDivisions = new Set();
Â  Â  Â  Â  divs.forEach(div => {
Â  Â  Â  Â  Â  const id = `div-${div.replace(/\s+/g, '_')}`;
Â  Â  Â  Â  Â  const label = document.createElement('label');
Â  Â  Â  Â  Â  label.innerHTML = `<input type="checkbox" id="${id}" value="${div}"> ${div}`;
Â  Â  Â  Â  Â  filtersEl.appendChild(label);
Â  Â  Â  Â  Â  label.querySelector('input').addEventListener('change', (e) => {
Â  Â  Â  Â  Â  Â  const val = e.target.value;
Â  Â  Â  Â  Â  Â  if (e.target.checked) activeDivisions.add(val);
Â  Â  Â  Â  Â  Â  else activeDivisions.delete(val);
Â  Â  Â  Â  Â  Â  render(document.getElementById('searchInput').value);
Â  Â  Â  Â  Â  });
Â  Â  Â  Â  });

        // MANTIDO: o meta.textContent exibia o status anterior Ã  contagem dinÃ¢mica
Â  Â  Â  Â  meta.textContent = `Atualizado: ${new Date(data.updatedAt).toLocaleString()} â€¢ Total: ${data.totalPedidos}`;
Â  Â  Â  Â  render(document.getElementById('searchInput').value);
Â  Â  Â  } catch (err) {
Â  Â  Â  Â  const sections = document.getElementById('sections');
Â  Â  Â  Â  const errorDiv = document.createElement('div');
Â  Â  Â  Â  errorDiv.className = 'empty';
Â  Â  Â  Â  errorDiv.textContent = err?.message || 'Erro ao carregar dados.';
Â  Â  Â  Â  sections.innerHTML = '';
Â  Â  Â  Â  sections.appendChild(errorDiv);
Â  Â  Â  Â  meta.textContent = 'Erro ao carregar dados.';
Â  Â  Â  }
Â  Â  }

Â  Â  // Busca
Â  Â  document.getElementById('searchInput').addEventListener('input', (e) => {
Â  Â  Â  render(e.target.value);
Â  Â  });

Â  Â  // Filtros de categoria
Â  Â  document.querySelectorAll('.filter-btn').forEach(btn => {
Â  Â  Â  btn.addEventListener('click', () => {
Â  Â  Â  Â  document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
Â  Â  Â  Â  btn.classList.add('active');
Â  Â  Â  Â  activeCategory = btn.dataset.cat;
Â  Â  Â  Â  render(document.getElementById('searchInput').value);
Â  Â  Â  });
Â  Â  });

Â  Â  // BotÃ£o atualizar
Â  Â  document.getElementById('refreshBtn').addEventListener('click', loadAndRender);

Â  Â  // Primeira carga e auto-refresh
Â  Â  loadAndRender();
Â  Â  setInterval(loadAndRender, AUTO_REFRESH_MS);


Â  Â  // --- LÃ“GICA DE ALTERNÃ‚NCIA DE VIEW ---
Â  Â  function toggleView(view) {
Â  Â  Â  const dashboard = document.getElementById('dashboardContent');
Â  Â  Â  const tracker = document.getElementById('trackerContent');
Â  Â  Â  const trackerLink = document.getElementById('trackerLink');
Â  Â  Â Â 
Â  Â  Â  if (view === 'dashboard') {
Â  Â  Â  Â  Â  dashboard.style.display = 'block'; // Usar 'block' para o fluxo normal de layout
Â  Â  Â  Â  Â  tracker.style.display = 'none';
Â  Â  Â  Â  Â  trackerLink.style.background = 'var(--primary)'; // Cor inativa
Â  Â  Â  Â  Â  render(document.getElementById('searchInput').value);
Â  Â  Â  } else if (view === 'tracker') {
Â  Â  Â  Â  Â  dashboard.style.display = 'none';
Â  Â  Â  Â  Â  tracker.style.display = 'block';
Â  Â  Â  Â  Â  trackerLink.style.background = 'var(--accent)'; // Cor ativa
Â  Â  Â  }
Â  Â  }


Â  Â  // --- LÃ“GICA DO RASTREADOR DE PEDIDOS (RENOMEADA PARA EVITAR CONFLITO) ---
Â  Â  const RASTREADOR_WEB_APP_URL = 'https://script.google.com/a/macros/doremus.com.br/s/AKfycbxTGO3RP3O8EgJ9CL_Y4PaoEbqjnLgHG8Mr1vP_aCQscMWY0pdNQ_U7IN8NysDNMrD9/exec';
Â  Â Â 
Â  Â  let ultimoResultado = null;
Â  Â  let ultimoNumeroPedido = null;
Â  Â  let itensDoPedido = [];

Â  Â  function rastreadorBuscarPedido() {
Â  Â  Â  const orderNumber = document.getElementById('orderNumber').value.trim();
Â  Â  Â Â 
Â  Â  Â  if (!orderNumber) {
Â  Â  Â  Â  rastreadorMostrarErro('Por favor, digite um nÃºmero de pedido');
Â  Â  Â  Â  return;
Â  Â  Â  }
Â  Â  Â Â 
Â  Â  Â  ultimoNumeroPedido = orderNumber;
Â  Â  Â  rastreadorMostrarCarregando('Buscando itens do pedido...');
Â  Â  Â Â 
Â  Â  Â  fetch(RASTREADOR_WEB_APP_URL + '?action=listarItens&numero=' + encodeURIComponent(orderNumber))
Â  Â  Â  Â  .then(response => {
Â  Â  Â  Â  Â  if (!response.ok) {
Â  Â  Â  Â  Â  Â  throw new Error('Erro na resposta do servidor: ' + response.status);
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  return response.json();
Â  Â  Â  Â  })
Â  Â  Â  Â  .then(resultado => rastreadorProcessarListaItens(resultado))
Â  Â  Â  Â  .catch(erro => rastreadorMostrarErro('Erro ao conectar ao servidor: ' + erro.message));
Â  Â  }

Â  Â  function rastreadorProcessarListaItens(resultado) {
Â  Â  Â  Â  const resultsDiv = document.getElementById('trackerResults');

Â  Â  Â  Â  if (resultado.erro) {
Â  Â  Â  Â  Â  Â  rastreadorMostrarErro(resultado.erro);
Â  Â  Â  Â  Â  Â  document.getElementById('itemSelectionContainer').style.display = 'none';
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }

Â  Â  Â  Â  itensDoPedido = resultado.itens || [];
Â  Â  Â  Â  ultimoResultado = resultado;

Â  Â  Â  Â  let infoHtml = '<div class="success">âœ… Pedido encontrado! Selecione os itens para rastrear.</div>';
Â  Â  Â  Â  infoHtml += '<div class="order-info">';
Â  Â  Â  Â  infoHtml += '<div class="info-row">';
Â  Â  Â  Â  infoHtml += '<div class="info-item">';
Â  Â  Â  Â  infoHtml += '<div class="info-label">NÃºmero do Pedido</div>';
Â  Â  Â  Â  infoHtml += '<div class="info-value">' + resultado.numero + '</div>';
Â  Â  Â  Â  infoHtml += '</div>';
Â  Â  Â  Â  infoHtml += '<div class="info-item">';
Â  Â  Â  Â  infoHtml += '<div class="info-label">Cliente</div>';
Â  Â  Â  Â  infoHtml += '<div class="info-value">' + resultado.cliente + '</div>';
Â  Â  Â  Â  infoHtml += '</div>';
Â  Â  Â  Â  infoHtml += '</div>';
Â  Â  Â  Â  infoHtml += '<div class="info-row">';
Â  Â  Â  Â  infoHtml += '<div class="info-item">';
Â  Â  Â  Â  infoHtml += '<div class="info-label">Data de Entrega Prevista</div>';
Â  Â  Â  Â  infoHtml += '<div class="info-value">' + resultado.entrega + '</div>';
Â  Â  Â  Â  infoHtml += '</div>';
Â  Â  Â  Â  infoHtml += '</div>';
Â  Â  Â  Â  infoHtml += '</div>';
Â  Â  Â  Â Â 
Â  Â  Â  Â  resultsDiv.innerHTML = infoHtml;
Â  Â  Â  Â  resultsDiv.classList.add('show');
Â  Â  Â  Â  document.getElementById('downloadGroup').style.display = 'none';

Â  Â  Â  Â  const itemListDiv = document.getElementById('itemList');
Â  Â  Â  Â  itemListDiv.innerHTML = '';
Â  Â  Â  Â  itensDoPedido.forEach((item, index) => {
Â  Â  Â  Â  Â  Â  itemListDiv.innerHTML += `
Â  Â  Â  Â  Â  Â  Â  Â  <label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="checkbox" name="item" value="${item}" checked>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${item}
Â  Â  Â  Â  Â  Â  Â  Â  </label>
Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  });

Â  Â  Â  Â  document.getElementById('itemSelectionContainer').style.display = 'block';
Â  Â  }

Â  Â  function rastreadorRastrearItens() {
Â  Â  Â  Â  const selectedItems = Array.from(document.querySelectorAll('#itemList input[name="item"]:checked'))
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â .map(checkbox => checkbox.value);

Â  Â  Â  Â  if (selectedItems.length === 0) {
Â  Â  Â  Â  Â  Â  rastreadorMostrarErro('Por favor, selecione pelo menos um item para rastrear.');
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }

Â  Â  Â  Â  rastreadorMostrarCarregando('Rastreando status dos itens selecionados...');

Â  Â  Â  Â  fetch(RASTREADOR_WEB_APP_URL + '?action=buscarStatus&numero=' + encodeURIComponent(ultimoNumeroPedido) + '&itens=' + encodeURIComponent(JSON.stringify(selectedItems)))
Â  Â  Â  Â  Â  .then(response => {
Â  Â  Â  Â  Â  Â  if (!response.ok) {
Â  Â  Â  Â  Â  Â  Â  throw new Error('Erro na resposta do servidor: ' + response.status);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  return response.json();
Â  Â  Â  Â  Â  })
Â  Â  Â  Â  Â  .then(resultado => rastreadorMostrarResultado(resultado))
Â  Â  Â  Â  Â  .catch(erro => rastreadorMostrarErro('Erro ao conectar ao servidor: ' + erro.message));
Â  Â  }
Â  Â Â 
Â  Â  function rastreadorMostrarCarregando(mensagem) {
Â  Â  Â  const resultsDiv = document.getElementById('trackerResults');
Â  Â  Â  resultsDiv.innerHTML = '<div class="loading"><div class="spinner"></div>' + mensagem + '</div>';
Â  Â  Â  resultsDiv.classList.add('show');
Â  Â  Â  document.getElementById('itemSelectionContainer').style.display = 'none';
Â  Â  Â  document.getElementById('downloadGroup').style.display = 'none';
Â  Â  }
Â  Â Â 
Â  Â  function rastreadorMostrarResultado(resultado) {
Â  Â  Â  const resultsDiv = document.getElementById('trackerResults');
Â  Â  Â Â 
Â  Â  Â  if (resultado.erro) {
Â  Â  Â  Â  resultsDiv.innerHTML = '<div class="error">âŒ ' + resultado.erro + '</div>';
Â  Â  Â  Â  resultsDiv.classList.add('show');
Â  Â  Â  Â  document.getElementById('downloadGroup').style.display = 'none';
Â  Â  Â  Â  return;
Â  Â  Â  }
Â  Â  Â Â 
Â  Â  Â  ultimoResultado.itensSelecionados = resultado.itensSelecionados;
Â  Â  Â  ultimoResultado.atualizacoesAgrupadas = resultado.atualizacoesAgrupadas;

Â  Â  Â  const itensExibicao = resultado.itensSelecionados.join('; ');

Â  Â  Â  let html = '<div class="success">âœ… Rastreamento concluÃ­do para: ' + itensExibicao + '</div>';
Â  Â  Â Â 
Â  Â  Â  html += '<div class="order-info">';
Â  Â  Â  html += '<div class="info-row">';
Â  Â  Â  html += '<div class="info-item">';
Â  Â  Â  html += '<div class="info-label">NÃºmero do Pedido</div>';
Â  Â  Â  html += '<div class="info-value">' + ultimoResultado.numero + '</div>';
Â  Â  Â  html += '</div>';
Â  Â  Â  html += '<div class="info-item">';
Â  Â  Â  html += '<div class="info-label">Cliente</div>';
Â  Â  Â  html += '<div class="info-value">' + ultimoResultado.cliente + '</div>';
Â  Â  Â  html += '</div>';
Â  Â  Â  html += '</div>';
Â  Â  Â Â 
Â  Â  Â  html += '<div class="info-row">';
Â  Â  Â  html += '<div class="info-item">';
Â  Â  Â  html += '<div class="info-label">Data de Entrega Prevista</div>';
Â  Â  Â  html += '<div class="info-value">' + ultimoResultado.entrega + '</div>';
Â  Â  Â  html += '</div>';
Â  Â  Â  html += '<div class="info-item">';
Â  Â  Â  html += '<div class="info-label">Itens Rastreando</div>';
Â  Â  Â  html += '<div class="info-value">' + itensExibicao + '</div>';
Â  Â  Â  html += '</div>';
Â  Â  Â  html += '</div>';
Â  Â  Â  html += '</div>';
Â  Â  Â Â 
Â  Â  Â  html += '<div class="timeline">';
Â  Â  Â  html += '<div class="timeline-title">ğŸ“… HistÃ³rico de AtualizaÃ§Ãµes</div>';
Â  Â  Â Â 
Â  Â  Â  const itensAgrupados = resultado.atualizacoesAgrupadas;
Â  Â  Â  const itensOrdenados = Object.keys(itensAgrupados).sort();

Â  Â  Â  if (itensOrdenados.length === 0) {
Â  Â  Â  Â  Â  html += '<p>Nenhuma atualizaÃ§Ã£o de status encontrada para os itens selecionados.</p>';
Â  Â  Â  } else {
Â  Â  Â  Â  Â  itensOrdenados.forEach(function(item) {
Â  Â  Â  Â  Â  Â  Â  const atualizacoes = itensAgrupados[item];
Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  html += '<h3 class="item-timeline-title">Item: ' + item + '</h3>';

Â  Â  Â  Â  Â  Â  Â  atualizacoes.forEach(function(atualizacao) {
Â  Â  Â  Â  Â  Â  Â  Â  const classe = atualizacao.atrasado ? 'atrasado' : (atualizacao.entregue ? 'entregue' : '');
Â  Â  Â  Â  Â  Â  Â  Â  const badge = atualizacao.atrasado ? '<span class="tracker-badge badge-atrasado">ATRASADO</span>' : (atualizacao.entregue ? '<span class="tracker-badge badge-entregue">ENTREGUE</span>' : '');
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  html += '<div class="timeline-item ' + classe + '">';
Â  Â  Â  Â  Â  Â  Â  Â  html += '<div class="timeline-status">' + atualizacao.status + badge + '</div>';
Â  Â  Â  Â  Â  Â  Â  Â  html += '<div class="timeline-previsao">' + atualizacao.previsao + '</div>';
Â  Â  Â  Â  Â  Â  Â  Â  html += '<div class="timeline-motivo">Motivo: ' + atualizacao.motivo + '</div>';
Â  Â  Â  Â  Â  Â  Â  Â  html += '<div class="timeline-data">' + atualizacao.data + '</div>';
Â  Â  Â  Â  Â  Â  Â  Â  html += '</div>';
Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  });
Â  Â  Â  }
Â  Â  Â Â 
Â  Â  Â  html += '</div>';
Â  Â  Â Â 
Â  Â  Â  resultsDiv.innerHTML = html;
Â  Â  Â  resultsDiv.classList.add('show');
Â  Â  Â  document.getElementById('downloadGroup').style.display = 'flex';
Â  Â  Â  document.getElementById('itemSelectionContainer').style.display = 'none';
Â  Â  }
Â  Â Â 
Â  Â  function rastreadorMostrarErro(erro) {
Â  Â  Â  const resultsDiv = document.getElementById('trackerResults');
Â  Â  Â  resultsDiv.innerHTML = '<div class="error">âŒ Erro: ' + erro + '</div>';
Â  Â  Â  resultsDiv.classList.add('show');
Â  Â  Â  document.getElementById('itemSelectionContainer').style.display = 'none';
Â  Â  Â  document.getElementById('downloadGroup').style.display = 'none';
Â  Â  }
Â  Â Â 
Â  Â  function rastreadorLimpar() {
Â  Â  Â  document.getElementById('orderNumber').value = '';
Â  Â  Â  document.getElementById('trackerResults').innerHTML = '';
Â  Â  Â  document.getElementById('trackerResults').classList.remove('show');
Â  Â  Â  document.getElementById('downloadGroup').style.display = 'none';
Â  Â  Â  document.getElementById('itemSelectionContainer').style.display = 'none';
Â  Â  Â  document.getElementById('orderNumber').focus();
Â  Â  Â  ultimoResultado = null;
Â  Â  Â  ultimoNumeroPedido = null;
Â  Â  Â  itensDoPedido = [];
Â  Â  }
Â  Â Â 
Â  Â  function rastreadorBaixarPDF() {
Â  Â  Â  if (!ultimoResultado || !ultimoResultado.atualizacoesAgrupadas) {
Â  Â  Â  Â  Â  rastreadorMostrarErro('Nenhum resultado para baixar. Por favor, rastreie um pedido primeiro.');
Â  Â  Â  Â  Â  return;
Â  Â  Â  }
Â  Â  Â Â 
Â  Â  Â  const { jsPDF } = window.jspdf;
Â  Â  Â  const doc = new jsPDF();
Â  Â  Â Â 
Â  Â  Â  const pageWidth = doc.internal.pageSize.getWidth();
Â  Â  Â  const pageHeight = doc.internal.pageSize.getHeight();
Â  Â  Â  const margin = 15;
Â  Â  Â  const lineHeight = 7;
Â  Â  Â  let yPosition = margin;
Â  Â  Â Â 
Â  Â  Â  const corPrimaria = [0, 71, 171];
Â  Â  Â  const corSecundaria = [204, 0, 0];
Â  Â  Â  const corTexto = [51, 51, 51];
Â  Â  Â  const corTextoClaro = [153, 153, 153];
Â  Â  Â Â 
Â  Â  Â  doc.setFillColor(...corPrimaria);
Â  Â  Â  doc.rect(0, 0, pageWidth, 30, 'F');
Â  Â  Â Â 
Â  Â  Â  doc.setTextColor(255, 255, 255);
Â  Â  Â  doc.setFontSize(20);
Â  Â  Â  doc.setFont(undefined, 'bold');
Â  Â  Â  doc.text('RASTREADOR DE PEDIDOS', margin + 5, 15);
Â  Â  Â Â 
Â  Â  Â  doc.setFontSize(10);
Â  Â  Â  doc.setFont(undefined, 'normal');
Â  Â  Â  doc.text('RelatÃ³rio de Acompanhamento', margin + 5, 23);
Â  Â  Â Â 
Â  Â  Â  yPosition = 40;
Â  Â  Â Â 
Â  Â  Â  doc.setTextColor(...corPrimaria);
Â  Â  Â  doc.setFontSize(12);
Â  Â  Â  doc.setFont(undefined, 'bold');
Â  Â  Â  doc.text('INFORMAÃ‡Ã•ES DO PEDIDO', margin, yPosition);
Â  Â  Â  yPosition += 8;
Â  Â  Â Â 
Â  Â  Â  doc.setTextColor(...corTexto);
Â  Â  Â  doc.setFontSize(10);
Â  Â  Â  doc.setFont(undefined, 'normal');
Â  Â  Â Â 
Â  Â  Â  const infoData = [
Â  Â  Â  Â  ['NÃºmero do Pedido:', ultimoResultado.numero],
Â  Â  Â  Â  ['Cliente:', ultimoResultado.cliente],
Â  Â  Â  Â  ['Data de Entrega Prevista:', ultimoResultado.entrega],
Â  Â  Â  Â  ['Itens Rastreados:', ultimoResultado.itensSelecionados.join(', ')]
Â  Â  Â  ];
Â  Â  Â Â 
Â  Â  Â  infoData.forEach(([label, value]) => {
Â  Â  Â  Â  if (yPosition > pageHeight - margin - 20) {
Â  Â  Â  Â  Â  doc.addPage();
Â  Â  Â  Â  Â  yPosition = margin;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  doc.setFont(undefined, 'bold');
Â  Â  Â  Â  doc.setTextColor(...corPrimaria);
Â  Â  Â  Â  doc.text(label, margin, yPosition);
Â  Â  Â  Â Â 
Â  Â  Â  Â  doc.setFont(undefined, 'normal');
Â  Â  Â  Â  doc.setTextColor(...corTexto);
Â  Â  Â  Â  const textWidth = pageWidth - (margin * 2) - 60;
Â  Â  Â  Â  const splitText = doc.splitTextToSize(value, textWidth);
Â  Â  Â  Â  doc.text(splitText, margin + 60, yPosition);
Â  Â  Â  Â Â 
Â  Â  Â  Â  yPosition += lineHeight + 2;
Â  Â  Â  });
Â  Â  Â Â 
Â  Â  Â  yPosition += 5;
Â  Â  Â Â 
Â  Â  Â  Object.keys(ultimoResultado.atualizacoesAgrupadas).forEach(item => {
Â  Â  Â  Â  if (yPosition > pageHeight - margin - 15) {
Â  Â  Â  Â  Â  doc.addPage();
Â  Â  Â  Â  Â  yPosition = margin;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  doc.setTextColor(...corPrimaria);
Â  Â  Â  Â  doc.setFontSize(11);
Â  Â  Â  Â  doc.setFont(undefined, 'bold');
Â  Â  Â  Â  doc.text('Item: ' + item, margin, yPosition);
Â  Â  Â  Â  yPosition += 8;
Â  Â  Â  Â Â 
Â  Â  Â  Â  ultimoResultado.atualizacoesAgrupadas[item].forEach(atualizacao => {
Â  Â  Â  Â  Â  if (yPosition > pageHeight - margin - 15) {
Â  Â  Â  Â  Â  Â  doc.addPage();
Â  Â  Â  Â  Â  Â  yPosition = margin;
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  doc.setFillColor(...corPrimaria);
Â  Â  Â  Â  Â  doc.circle(margin + 5, yPosition + 2, 2.5, 'F');
Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  doc.setFont(undefined, 'bold');
Â  Â  Â  Â  Â  doc.setTextColor(...corTexto);
Â  Â  Â  Â  Â  doc.setFontSize(10);
Â  Â  Â  Â  Â  let statusText = atualizacao.status;
Â  Â  Â  Â  Â  if (atualizacao.atrasado) statusText += ' [ATRASADO]';
Â  Â  Â  Â  Â  else if (atualizacao.entregue) statusText += ' [ENTREGUE]';
Â  Â  Â  Â  Â  doc.text(statusText, margin + 12, yPosition + 2);
Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  yPosition += 5;
Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  doc.setFont(undefined, 'normal');
Â  Â  Â  Â  Â  doc.setTextColor(...corTextoClaro);
Â  Â  Â  Â  Â  doc.setFontSize(9);
Â  Â  Â  Â  Â  doc.text('PrevisÃ£o: ' + atualizacao.previsao, margin + 12, yPosition);
Â  Â  Â  Â  Â  yPosition += 4;
Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  const motivoText = doc.splitTextToSize('Motivo: ' + atualizacao.motivo, pageWidth - (margin * 2) - 12);
Â  Â  Â  Â  Â  doc.text(motivoText, margin + 12, yPosition);
Â  Â  Â  Â  Â  yPosition += (motivoText.length * 3) + 2;
Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  doc.setTextColor(200, 200, 200);
Â  Â  Â  Â  Â  doc.setFontSize(8);
Â  Â  Â  Â  Â  doc.text('Data: ' + atualizacao.data, margin + 12, yPosition);
Â  Â  Â  Â  Â  yPosition += 6;
Â  Â  Â  Â  });
Â  Â  Â  Â Â 
Â  Â  Â  Â  yPosition += 5;
Â  Â  Â  });
Â  Â  Â Â 
Â  Â  Â  const totalPages = doc.internal.getNumberOfPages();
Â  Â  Â  for (let i = 1; i <= totalPages; i++) {
Â  Â  Â  Â  doc.setPage(i);
Â  Â  Â  Â  doc.setTextColor(200, 200, 200);
Â  Â  Â  Â  doc.setFontSize(8);
Â  Â  Â  Â  doc.text(
Â  Â  Â  Â  Â  'PÃ¡gina ' + i + ' de ' + totalPages + ' | Gerado em ' + new Date().toLocaleString('pt-BR'),
Â  Â  Â  Â  Â  margin,
Â  Â  Â  Â  Â  pageHeight - 8
Â  Â  Â  Â  );
Â  Â  Â  }
Â  Â  Â Â 
Â  Â  Â  doc.save('Rastreamento_Pedido_' + ultimoNumeroPedido + '.pdf');
Â  Â  }
Â  </script>
</body>

</html>
